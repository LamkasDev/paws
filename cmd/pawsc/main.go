package main

import (
	"fmt"
	"os"

	"github.com/LamkasDev/paws/cmd/common/elf"
)

func main() {
	f, err := os.OpenFile("main", os.O_CREATE|os.O_RDWR|os.O_TRUNC, 777)
	if err != nil {
		panic(err)
	}
	defer f.Close()
	writer := elf.NewElfWriter(f)

	elf.EncodeElf(writer, elf.NewElf(elf.ElfProgram{
		Sections: []elf.ElfProgramSection{
			{
				Name:  "world.c",
				Align: 1,
			},
			{
				Name: "myprint",
				Data: []byte{
					0xF3, 0x0F, 0x1E, 0xFA, 0x48, 0x8B, 0x0D, 0x7D, 0x00, 0x00, 0x00, 0x48, 0xC7, 0xC0, 0x01, 0x00,
					0x00, 0x00, 0x48, 0xC7, 0xC7, 0x01, 0x00, 0x00, 0x00, 0x48, 0x89, 0xCE, 0x48, 0xC7, 0xC2, 0x0D,
					0x00, 0x00, 0x00, 0x0F, 0x05, 0xC3,
				},
				Align: 16,
			},
			{
				Name: "myexit",
				Data: []byte{
					0xF3, 0x0F, 0x1E, 0xFA, 0x48, 0xC7, 0xC0, 0x3C, 0x00, 0x00, 0x00, 0x48, 0x31, 0xFF, 0x0F, 0x05,
					0xC3,
				},
				Align: 16,
			},
			{
				Name: "nomain",
				Data: []byte{
					0xF3, 0x0F, 0x1E, 0xFA, 0x48, 0x8B, 0x0D, 0x2D, 0x00, 0x00, 0x00, 0x48, 0xC7, 0xC0, 0x01, 0x00,
					0x00, 0x00, 0x48, 0xC7, 0xC7, 0x01, 0x00, 0x00, 0x00, 0x48, 0x89, 0xCE, 0x48, 0xC7, 0xC2, 0x0D,
					0x00, 0x00, 0x00, 0x0F, 0x05, 0x48, 0xC7, 0xC0, 0x3C, 0x00, 0x00, 0x00, 0x48, 0x31, 0xFF, 0x0F,
					0x05, 0xC3,
				},
				Align: 16,
			},
			{
				Name: "str",
				Data: []byte{
					0x80, 0x81, 0x04, 0x08, 0x00, 0x00, 0x00, 0x00,
					0x68, 0x65, 0x6C, 0x6C, 0x6F, 0x2C, 0x20, 0x77, 0x6F, 0x72, 0x6C, 0x64, 0x0A, 0x00,
				},
				Align: 8,
			},
		},
	}))
	if err != nil {
		panic(err)
	}

	fmt.Printf("done :3")
}
